% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/genes_adjust_wrappers.R
\name{magcat_adjust_gene_p}
\alias{magcat_adjust_gene_p}
\title{Adjust MAGMA gene p-values using gene length and NSNPS}
\usage{
magcat_adjust_gene_p(
  gene_results,
  gene_lengths,
  gene_col = "GENE",
  nsnp_col = "NSNPS",
  p_col = "P",
  z_col = "ZSTAT",
  len_gene_col = "gene_id",
  len_col = "length",
  log1p_covars = TRUE
)
}
\arguments{
\item{gene_results}{data.frame. Gene-level results from MAGMA (typically
from reading a \code{.genes.out} file). Must contain gene ID, p-value, and
NSNPS columns.}

\item{gene_lengths}{data.frame. Gene lengths, typically from
\code{\link{get_gene_lengths}}. Must contain gene ID and length columns.}

\item{gene_col}{character. Column name in \code{gene_results} for gene IDs.
Default "GENE".}

\item{nsnp_col}{character. Column name in \code{gene_results} for the number
of SNPs per gene. Default "NSNPS".}

\item{p_col}{character. Column name in \code{gene_results} for raw p-values.
Default "P".}

\item{z_col}{character or NULL. Column name for Z-scores in \code{gene_results}.
If NULL or not present, Z-scores are reconstructed from p-values (magnitude
only). Default "ZSTAT".}

\item{len_gene_col}{character. Column name in \code{gene_lengths} for gene IDs.
Default "gene_id".}

\item{len_col}{character. Column name in \code{gene_lengths} for gene length.
Default "length".}

\item{log1p_covars}{logical. If TRUE (default), apply log(1+x) transformation
to NSNPS and gene length covariates before regression.}
}
\value{
data.frame with columns:
\describe{
\item{gene_id}{Gene identifier}
\item{z_adj}{Adjusted Z-score (residuals from regression)}
\item{p_adj}{Adjusted p-value derived from \code{z_adj}}
\item{fit}{List column containing the lm fit object for each gene}
}
An attribute "lm_fit" is also attached with the linear model object.
}
\description{
Regresses out the effect of gene length and number of SNPs (NSNPS) from
gene-level Z-statistics. This can reduce bias from longer genes having
more SNPs and therefore more significant p-values.
}
\examples{
\dontrun{
# Load gene results from MAGMA
gene_results <- read.delim("magma_output.genes.out")

# Get gene lengths from GFF3
gene_lengths <- get_gene_lengths("reference.gff3")

# Adjust gene p-values
adjusted <- magcat_adjust_gene_p(
  gene_results = gene_results,
  gene_lengths = gene_lengths,
  gene_col = "GENE",
  nsnp_col = "NSNPS",
  p_col = "P"
)

# Use adjusted p-values for pathway analysis
gene_results$P_adj <- adjusted$p_adj[match(gene_results$GENE, adjusted$gene_id)]
}

}
\seealso{
\code{\link{magma_gene}}, \code{\link{get_gene_lengths}}
}
