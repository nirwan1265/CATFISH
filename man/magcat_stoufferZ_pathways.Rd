% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Stouffer_wrappers.R
\name{magcat_stoufferZ_pathways}
\alias{magcat_stoufferZ_pathways}
\title{Pathway-level (weighted) Stouffer Z test on gene-level Z statistics}
\usage{
magcat_stoufferZ_pathways(
  gene_results,
  pathways = NULL,
  species = NULL,
  pmn_gene_col = NULL,
  gene_col = "GENE",
  z_col = "ZSTAT",
  weight_col = NULL,
  min_abs_w = 1e-08,
  alternative = c("greater", "two.sided", "less"),
  output = FALSE,
  out_dir = "magcat_stouffer_z"
)
}
\arguments{
\item{gene_results}{data.frame with at least a gene ID column and a Z-statistic column.
For MAGMA \code{.genes.out}, you may have \code{GENE} and \code{ZSTAT} (or similar).}

\item{pathways}{Either:
\itemize{
\item A named list: each element is a character vector of gene IDs in that pathway, OR
\item A data.frame with columns \code{pathway_id}, \code{gene_id} (and optional \code{pathway_name}).
}}

\item{species}{Optional; one of "maize", "sorghum", "arabidopsis", "plant", "fly".
If provided, built-in PMN pathways are loaded via \code{magcat_load_pathways()}.
Provide either \code{pathways} OR \code{species}, but not both.}

\item{pmn_gene_col}{Optional; passed to \code{magcat_load_pathways(gene_col=...)}
when \code{species} is used. If NULL, the PMN loader prefers "Gene-name"
then "Gene-id".}

\item{gene_col}{Column name in \code{gene_results} containing gene IDs (default "GENE").}

\item{z_col}{Column name in \code{gene_results} containing gene-level Z statistics (default "ZSTAT").}

\item{weight_col}{Optional column name in \code{gene_results} for per-gene weights
(default NULL = equal weights). Examples: \code{sqrt(NSNPS)}, \code{1/SE}, etc.}

\item{min_abs_w}{Non-finite / NA / <=0 weights are replaced by this small positive value
(default 1e-8).}

\item{alternative}{One of \code{"greater"}, \code{"two.sided"}, \code{"less"}.
\code{"greater"} tests for positive enrichment (default "greater").}

\item{output}{If TRUE, write a CSV of results to \code{out_dir}.}

\item{out_dir}{Directory to write CSV when \code{output = TRUE} (default "magcat_stouffer_z").}
}
\value{
A data.frame with columns:
\describe{
\item{pathway_id}{Pathway identifier}
\item{pathway_name}{Pathway name (if available; otherwise equals \code{pathway_id})}
\item{n_genes}{Number of genes used in the pathway}
\item{gene_names}{Semicolon-separated gene IDs actually used (from \code{gene_results})}
\item{gene_zvals}{Semicolon-separated Z statistics actually used}
\item{stouffer_Z}{Combined Stouffer Z-score}
\item{stouffer_p}{Analytic p-value under the chosen \code{alternative}}
}
Rows are sorted by \code{stouffer_p} in increasing order (smallest p first; NA at bottom).
If \code{output = TRUE}, an attribute \code{"file"} is attached with the CSV path.
}
\description{
Computes a (possibly weighted) Stouffer Z within each pathway:
\deqn{Z_S = \frac{\sum_{g \in S} w_g Z_g}{\sqrt{\sum_{g \in S} w_g^2}}}
}
\details{
and returns a p-value using the requested \code{alternative}:
\itemize{
\item \code{"two.sided"}: \eqn{p = 2 \Phi(-|Z_S|)}
\item \code{"greater"}:  \eqn{p = \Pr(Z \ge Z_S)}
\item \code{"less"}:     \eqn{p = \Pr(Z \le Z_S)}
}

Gene IDs are matched case-insensitively: both \code{gene_results[[gene_col]]} and
pathway gene IDs are normalized to lower-case before matching. Genes not present
in \code{gene_results} are dropped from that pathway.

NOTE: The analytic p-value assumes (approximately) independent \eqn{Z_g} within a pathway.
If genes are correlated (e.g., LD-induced correlation in MAGMA gene statistics), then this
analytic p-value may be anti-conservative. In MAGCAT/CATFISH, correlation-aware calibration
should be handled in your MVN/Omni layer (not inside this wrapper).
}
\examples{
\dontrun{
# Load gene results from MAGMA output (must include ZSTAT column)
gene_results <- read.delim("magma_output.genes.out")

# Run Stouffer's Z method on maize PMN pathways
stouffer_res <- magcat_stoufferZ_pathways(
  gene_results = gene_results,
  species = "maize",
  gene_col = "GENE",
  z_col = "ZSTAT"
)
head(stouffer_res)

# With weighted Stouffer (e.g., by number of SNPs)
stouffer_weighted <- magcat_stoufferZ_pathways(
  gene_results = gene_results,
  species = "maize",
  weight_col = "NSNPS"
)
}

}
\seealso{
\code{\link{magcat_acat_pathways}}, \code{\link{magcat_fisher_pathways}}
}
