% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/adaptive_soft_TFisher_wrappers.R
\name{magcat_soft_tfisher_adaptive_pathways}
\alias{magcat_soft_tfisher_adaptive_pathways}
\title{Pathway-level \emph{adaptive} soft TFisher (omnibus) on gene-level p-values}
\usage{
magcat_soft_tfisher_adaptive_pathways(
  gene_results,
  pathways = NULL,
  species = NULL,
  pmn_gene_col = NULL,
  gene_col = "GENE",
  p_col = "P",
  tau_grid = c(0.2, 0.1, 0.05, 0.02, 0.01, 0.005, 0.001),
  min_p = 1e-15,
  do_fix = TRUE,
  output = FALSE,
  out_dir = "magcat_tfisher_soft_adaptive"
)
}
\arguments{
\item{gene_results}{data.frame with at least a gene ID column and a p-value column.
For MAGMA \code{.genes.out}, these are commonly \code{GENE} and \code{P}.}

\item{pathways}{Either:
\itemize{
\item A named list: each element is a character vector of gene IDs in that pathway, OR
\item A data.frame with columns \code{pathway_id}, \code{gene_id} (and optional \code{pathway_name}).
}}

\item{species}{Optional; one of "maize", "sorghum", "arabidopsis", "plant".
If provided, built-in PMN pathways are loaded via \code{magcat_load_pathways()}.
Provide either \code{pathways} OR \code{species}, but not both.}

\item{pmn_gene_col}{Optional; passed to \code{magcat_load_pathways(gene_col=...)}
when \code{species} is used. If NULL, the PMN loader prefers "Gene-name" then "Gene-id".}

\item{gene_col}{Column name in \code{gene_results} containing gene IDs (default "GENE").}

\item{p_col}{Column name in \code{gene_results} containing gene-level p-values (default "P").}

\item{tau_grid}{Numeric vector of \code{tau} values to scan. Internally sorted increasing,
as required by \code{TFisher::stat.soft.omni()}.}

\item{min_p}{Lower cap for extremely small p-values before TFisher math (default 1e-15).}

\item{do_fix}{If TRUE (default), clean/cap p-values using \code{fix_p_for_acat()}
to ensure values lie strictly in (0,1).}

\item{output}{If TRUE, write a CSV of results to \code{out_dir}.}

\item{out_dir}{Directory to write CSV when \code{output = TRUE}
(default "magcat_tfisher_soft_adaptive").}
}
\value{
A data.frame with columns:
\describe{
\item{pathway_id}{Pathway identifier}
\item{pathway_name}{Pathway name (if available; otherwise equals \code{pathway_id})}
\item{n_genes}{Number of genes used in the pathway}
\item{gene_names}{Semicolon-separated gene IDs actually used (from \code{gene_results})}
\item{gene_pvals}{Semicolon-separated p-values actually used}
\item{tau_hat}{Tau achieving the minimum single-\code{tau} p-value}
\item{tfisher_stat_hat}{Soft TFisher statistic at \code{tau_hat}}
\item{tfisher_p_hat}{Single-\code{tau} right-tail p-value at \code{tau_hat}}
\item{tfisher_p_min}{Minimum single-\code{tau} p-value across \code{tau_grid} (= \eqn{W_o})}
\item{tfisher_p_omni}{Adaptive omnibus p-value for \eqn{W_o} under the null (independence)}
}

Rows are sorted by \code{tfisher_p_omni} in increasing order (smallest p first; NA at bottom).
If \code{output = TRUE}, an attribute \code{"file"} is attached with the CSV path.
}
\description{
For each pathway, this function:
\itemize{
\item extracts the pathway's gene-level p-values (e.g., from MAGMA \code{.genes.out})
\item computes soft-thresholding Fisher statistics across a grid of \code{tau} values
\item computes per-\code{tau} right-tail p-values under the null (via \code{TFisher::p.soft})
\item defines the adaptive score as \eqn{W_o = \min_{\tau \in \text{grid}} p_\tau}
\item computes a calibrated adaptive p-value under independence using
\code{TFisher::p.soft.omni(q = W_o, ...)}
}
}
\details{
Gene IDs are matched case-insensitively: both \code{gene_results[[gene_col]]} and
pathway gene IDs are normalized to lower-case before matching. Genes not present
in \code{gene_results} are dropped from that pathway.
}
\examples{
\dontrun{
# Load gene results from MAGMA output
gene_results <- read.delim("magma_output.genes.out")

# Run adaptive soft TFisher on maize PMN pathways
tfisher_adapt_res <- magcat_soft_tfisher_adaptive_pathways(
  gene_results = gene_results,
  species = "maize",
  gene_col = "GENE",
  p_col = "P"
)
head(tfisher_adapt_res)

# With custom tau grid
tfisher_custom <- magcat_soft_tfisher_adaptive_pathways(
  gene_results = gene_results,
  species = "maize",
  tau_grid = c(0.1, 0.05, 0.01)
)
}

}
\seealso{
\code{\link{magcat_tfisher_pathways}},
\code{\link{magcat_soft_tfisher_pathways}}
}
